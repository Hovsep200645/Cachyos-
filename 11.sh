#!/bin/bash
# hotplug_recovery.sh

echo "=== –ú–ï–¢–û–î –ì–û–†–Ø–ß–ï–ì–û –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø ==="
echo "1. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ recovery.img"
echo "2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç"
echo "3. –ë—ã—Å—Ç—Ä–æ –≤—Å—Ç–∞–≤–ª—è–π—Ç–µ/–≤—ã–Ω–∏–º–∞–π—Ç–µ USB –∫–∞–±–µ–ª—å 3-4 —Ä–∞–∑–∞"
echo "4. –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ—à–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"

while true; do
    if lsusb | grep -q "04e8"; then
        echo "üì± –¢–µ–ª–µ—Ñ–æ–Ω –æ–±–Ω–∞—Ä—É–∂–µ–Ω! –°—Ä–æ—á–Ω–æ –ø—Ä–æ—à–∏–≤–∞–µ–º..."
        
        # –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –ø—Ä–æ—à–∏–≤–∫–∞ —Ä–µ–∫–∞–≤–µ—Ä–∏
        if sudo heimdall flash --RECOVERY recovery.img --no-reboot --force; then
            echo "‚úÖ –†–µ–∫–∞–≤–µ—Ä–∏ –ø—Ä–æ—à–∏—Ç! –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É..."
            sudo heimdall reboot --recovery --force
            echo "üéâ –ö–û–ú–ê–ù–î–ê –û–¢–ü–†–ê–í–õ–ï–ù–ê! –ñ–¥–µ–º 30 —Å–µ–∫—É–Ω–¥..."
            sleep 30
            break
        fi
    fi
    sleep 0.5
done